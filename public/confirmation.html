<?php
function cleanInput($input) {
	$search = array(
		'@<script[^>]*?>.*?</script>@si',   // Strip out javascript
		'@<[\/\!]*?[^<>]*?>@si',            // Strip out HTML tags
		'@<style[^>]*?>.*?</style>@siU',    // Strip style tags properly
		'@<![\s\S]*?--[ \t\n\r]*>@'         // Strip multi-line comments
	);

	$output = preg_replace($search, '', $input);
	return $output;
}


if(empty($_POST)) {
	
} else {
	$ref = $_SERVER['HTTP_REFERER'];
	if (	strpos($ref, 'frozenrockets.nl') === false 
		&&  strpos($ref, 'petervangrieken.nl') === false
		&&  strpos($ref, 'frozenrockets.local') === false) {
	   die('Error: Wrong domain referer.');
	}


	$status= -1;
	$preventSend= false;

	$name= cleanInput($_POST['name']);
	$email= cleanInput($_POST['email']);
	$message= cleanInput($_POST['message']);

	if(trim($name) === "") {
		$status= 0;
		$preventSend= true;
	} 
	if(trim($email) === "") {
		$status= 0;
		$preventSend= true;
	} 
	if(trim($message) === "") {
		$status= 0;
		$preventSend= true;
	}


	if(!$preventSend) {
		$mailBody= "Van: ".$name."\n E-mail: ".$email."\n Bericht: \n".$message;

		if( mail('hi@frozenrockets.nl', 'Mail van contactformulier', $mailBody )) {
			$status= 1;
		} else {
			$status= -1;
		}	
	}
}
?>
<!DOCTYPE html>
<html lang="nl">
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="description" content="">
	<meta name="viewport" content="width=device-width, initial-scale=1">

	<title>Neem contact op met Frozen Rockets</title>

	<link rel="stylesheet" href="./css/style.min.css?1.01">
	<link rel="stylesheet" type="text/css" href="//cloud.typography.com/7599872/689164/css/fonts.css" />
	<link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
</head>

<body class="page page--contact">


	<div class="sidebar screen--contact">

		<a href="./index" class="borderless logo"><img src="./images/fr-logo.svg" alt="Frozen Rockets" id="main-logo-image"></a>

		<ol class="mainnav">
			<li class="mainnav__item"><a href="./projecten">Projecten</a></li>
			<li class="mainnav__item"><a href="./over-frozen-rockets">Over Frozen Rockets</a></li>
			<li class="mainnav__item"><a href="./contact.php">Contact</a></li>
		</ol>
	</div>

	<main>


		<h1>Contact?</h1>


		<form method="POST" action="confirmation" novalidate>

<?php
      if ($status === 0) {
        echo '<p class="status error">Oeps! Het lijkt er op dat niet alle velden ingevuld zijn.</p>';
      }elseif ($status === -1) {
        echo '<p class="status error">Oeps! Er ging iets mis aan mijn kant. Kunt u het nog eens proberen?</p>';
      } elseif ($status === 1) {
      	echo '<p class="status success">Je bericht is verzonden.</p>';
      	$hideForm= true;
      }

      if(!$hideForm) {

?>
			<p>
				De snelste manier om contact op te nemen, is door middel van onderstaand formulier.
				Ik bel of mail zo snel mogelijk terug.
			</p>

			<label>
				<span>Naam</span>

				<input type="text" name="name" id="contact-name" pattern="^[a-zA-Z-\' ]{3,50}$" required value="<?php echo $name; ?>">
				<span class="validation"></span>
			</label>

			<label>
				<span>E-mailadres</span>

				<input type="email" name="email" id="contact-email" pattern="[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\.[A-Za-z]{2,5}" required value="<?php echo $email; ?>">
				<span class="validation"></span>
			</label>

			<label>

				<span>Uw bericht</span>

				<textarea name="message" id="contact-message" required  value="<?php echo $$_POST['message']; ?>"></textarea>

			</label>


			<input type="submit" value="Verstuur" class="button button--secondary js-submit-contact">


<?php
		}
?>
		</form>



  </main>

<script type="text/javascript">
  var htmlElement= document.getElementsByTagName('html')[0];  
  var isSafari = /constructor/i.test(window.HTMLElement);
  
  if(isSafari) {
    if (htmlElement.classList) {
      htmlElement.classList.add('is-safari');
    } else {
      htmlElement.className += ' is-safari';
    }
  }

  if (!document.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#Image", "1.1")) {
    mainLogo= document.getElementById("main-logo-image");
    mainLogo.setAttribute('src', './images/fr-logo.svg');
  }


</script>

<!-- Piwik -->
<script type="text/javascript">
  var _paq = _paq || [];
  _paq.push(['trackPageView']);
  _paq.push(['enableLinkTracking']);
  (function() {
    var u=(("https:" == document.location.protocol) ? "https" : "http") + "://frozenrockets.nl/piwik/";
    _paq.push(['setTrackerUrl', u+'piwik.php']);
    _paq.push(['setSiteId', 1]);
    var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0]; g.type='text/javascript';
    g.defer=true; g.async=true; g.src=u+'piwik.js'; s.parentNode.insertBefore(g,s);
  })();

</script>
<noscript><p><img src="http://frozenrockets.nl/piwik/piwik.php?idsite=1" style="border:0;" alt="" /></p></noscript>
<!-- End Piwik Code -->
</body>
</html>